<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Mapa de Adoรงรฃo de Animais</title>
ย ยย
ย ย <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
ย ยย
ย ย ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
ย ยย
ย ย <style>
ย ย ย ย :root {
ย ย ย ย ย ย --bg-primary: #f0f2f5;
ย ย ย ย ย ย --bg-secondary: #ffffff;
ย ย ย ย ย ย --text-primary: #333333;
ย ย ย ย ย ย --text-secondary: #555555;
ย ย ย ย ย ย --header-gradient-1: #4facfe;
ย ย ย ย ย ย --header-gradient-2: #00f2fe;
ย ย ย ย ย ย --border-color: #e9ecef;
ย ย ย ย ย ย --shadow-color: rgba(0,0,0,0.1);
ย ย ย ย ย ย --input-bg: #ffffff;
ย ย ย ย ย ย --sidebar-bg: #ffffff;
ย ย ย ย }

ย ย ย ย [data-theme="dark"] {
ย ย ย ย ย ย --bg-primary: #1a1a1a;
ย ย ย ย ย ย --bg-secondary: #2d2d2d;
ย ย ย ย ย ย --text-primary: #e0e0e0;
ย ย ย ย ย ย --text-secondary: #b0b0b0;
ย ย ย ย ย ย --header-gradient-1: #2c5282;
ย ย ย ย ย ย --header-gradient-2: #1a365d;
ย ย ย ย ย ย --border-color: #404040;
ย ย ย ย ย ย --shadow-color: rgba(0,0,0,0.5);
ย ย ย ย ย ย --input-bg: #3a3a3a;
ย ย ย ย ย ย --sidebar-bg: #2d2d2d;
ย ย ย ย }

ย ย ย ย * { margin: 0; padding: 0; box-sizing: border-box; }
ย ย ย ยย
ย ย ย ย body {ย
ย ย ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;ย
ย ย ย ย ย ย background: var(--bg-primary);ย
ย ย ย ย ย ย min-height: 100vh;ย
ย ย ย ย ย ย display: flex;ย
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย transition: background 0.3s ease;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .header {ย
ย ย ย ย ย ย background: linear-gradient(135deg, var(--header-gradient-1) 0%, var(--header-gradient-2) 100%);ย
ย ย ย ย ย ย color: white;ย
ย ย ย ย ย ย padding: 20px;ย
ย ย ย ย ย ย text-align: center;ย
ย ย ย ย ย ย box-shadow: 0 4px 8px var(--shadow-color);
ย ย ย ย ย ย position: relative;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .header h1 { font-size: 2rem; margin-bottom: 5px; }
ย ย ย ย .header p { font-size: 1rem; opacity: 0.9; }
ย ย ย ยย
ย ย ย ย .header-controls {
ย ย ย ย ย ย position: absolute;
ย ย ย ย ย ย top: 20px;
ย ย ย ย ย ย right: 20px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย ย ย align-items: center;
ย ย ย ย }

ย ย ย ย .theme-toggle, .login-btn {
ย ย ย ย ย ย background: rgba(255,255,255,0.2);
ย ย ย ย ย ย border: 2px solid rgba(255,255,255,0.3);
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 8px 16px;
ย ย ย ย ย ย border-radius: 20px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย transition: all 0.3s;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 5px;
ย ย ย ย }

ย ย ย ย .theme-toggle:hover, .login-btn:hover {
ย ย ย ย ย ย background: rgba(255,255,255,0.3);
ย ย ย ย ย ย transform: scale(1.05);
ย ย ย ย }

ย ย ย ย .user-info {
ย ย ย ย ย ย background: rgba(255,255,255,0.2);
ย ย ย ย ย ย border: 2px solid rgba(255,255,255,0.3);
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 8px 16px;
ย ย ย ย ย ย border-radius: 20px;
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย }

ย ย ย ย .logout-btn {
ย ย ย ย ย ย background: rgba(255,100,100,0.8);
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 4px 12px;
ย ย ย ย ย ย border-radius: 12px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย font-size: 0.85rem;
ย ย ย ย }

ย ย ย ย .logout-btn:hover {
ย ย ย ย ย ย background: rgba(255,80,80,1);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .container { display: flex; flex-grow: 1; }
ย ย ย ยย
ย ย ย ย #map { flex-grow: 1; height: 100vh; min-height: 600px; }
ย ย ย ยย
ย ย ย ย .sidebar {ย
ย ย ย ย ย ย background: var(--sidebar-bg);ย
ย ย ย ย ย ย width: 350px;ย
ย ย ย ย ย ย padding: 20px;ย
ย ย ย ย ย ย box-shadow: -4px 0 8px var(--shadow-color);ย
ย ย ย ย ย ย overflow-y: auto;
ย ย ย ย ย ย transition: background 0.3s ease;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .sidebar h2 { margin-bottom: 20px; color: var(--text-primary); }
ย ย ย ยย
ย ย ย ย .sensor-info {ย
ย ย ย ย ย ย margin-bottom: 20px;ย
ย ย ย ย ย ย padding: 15px;ย
ย ย ย ย ย ย border-radius: 8px;ย
ย ย ย ย ย ย background: var(--bg-primary);ย
ย ย ย ย ย ย border: 1px solid var(--border-color);ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .sensor-info .sensor {ย
ย ย ย ย ย ย display: flex;ย
ย ย ย ย ย ย justify-content: space-between;ย
ย ย ย ย ย ย margin-bottom: 8px;ย
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย color: var(--text-primary);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .sensor-info .sensor strong { color: var(--text-secondary); }
ย ย ย ยย
ย ย ย ย .toggle-btn {ย
ย ย ย ย ย ย background: #6c757d;ย
ย ย ย ย ย ย color: white;ย
ย ย ย ย ย ย border: none;ย
ย ย ย ย ย ย padding: 10px;ย
ย ย ย ย ย ย border-radius: 5px;ย
ย ย ย ย ย ย width: 100%;ย
ย ย ย ย ย ย cursor: pointer;ย
ย ย ย ย ย ย margin-bottom: 20px;ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .toggle-btn:hover { background: #5a6268; }
ย ย ย ยย
ย ย ย ย #adoptionFormSection { display: none; }
ย ย ย ยย
ย ย ย ย .form-group { margin-bottom: 15px; }
ย ย ย ย .form-group label {ย
ย ย ย ย ย ย display: block;ย
ย ย ย ย ย ย margin-bottom: 5px;ย
ย ย ย ย ย ย font-weight: 600;ย
ย ย ย ย ย ย color: var(--text-primary);ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .form-group input, .form-group textarea {ย
ย ย ย ย ย ย width: 100%;ย
ย ย ย ย ย ย padding: 8px;ย
ย ย ย ย ย ย border: 1px solid var(--border-color);ย
ย ย ย ย ย ย border-radius: 4px;
ย ย ย ย ย ย background: var(--input-bg);
ย ย ย ย ย ย color: var(--text-primary);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .submit-btn {ย
ย ย ย ย ย ย background: #28a745;ย
ย ย ย ย ย ย color: white;ย
ย ย ย ย ย ย border: none;ย
ย ย ย ย ย ย padding: 10px;ย
ย ย ย ย ย ย border-radius: 5px;ย
ย ย ย ย ย ย width: 100%;ย
ย ย ย ย ย ย cursor: pointer;ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .submit-btn:hover { background: #218838; }
ย ย ย ยย
ย ย ย ย .submit-btn:disabled {
ย ย ย ย ย ย background: #6c757d;
ย ย ย ย ย ย cursor: not-allowed;
ย ย ย ย }

ย ย ย ย .compass-arrow {ย
ย ย ย ย ย ย display: inline-block;ย
ย ย ย ย ย ย transform-origin: center;ย
ย ย ย ย ย ย font-size: 24px;ย
ย ย ย ย ย ย transition: transform 0.2s;ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .leaflet-div-icon { background: transparent; border: none; }

ย ย ย ย /* Estilos do Popup de Adoรงรฃo */
ย ย ย ย .adoption-popup {
ย ย ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
ย ย ย ย ย ย min-width: 320px;
ย ย ย ย }

ย ย ย ย .adoption-popup h3 {
ย ย ย ย ย ย color: #4facfe;
ย ย ย ย ย ย margin-bottom: 10px;
ย ย ย ย ย ย font-size: 1.3rem;
ย ย ย ย ย ย border-bottom: 2px solid #4facfe;
ย ย ย ย ย ย padding-bottom: 8px;
ย ย ย ย }

ย ย ย ย .adoption-info {
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย font-size: 0.95rem;
ย ย ย ย ย ย line-height: 1.6;
ย ย ย ย }

ย ย ย ย .adoption-info p {
ย ย ย ย ย ย margin: 5px 0;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 8px;
ย ย ย ย }

ย ย ย ย .adoption-info strong {
ย ย ย ย ย ย color: #555;
ย ย ย ย ย ย min-width: 80px;
ย ย ย ย }

ย ย ย ย /* Estilos para Dark Mode */
ย ย ย ย [data-theme="dark"] .adoption-popup .adoption-info strong {
ย ย ย ย ย ย color: var(--text-secondary);
ย ย ย ย }

ย ย ย ย .pets-gallery {
ย ย ย ย ย ย margin-top: 15px;
ย ย ย ย }

ย ย ย ย .pets-gallery h4 {
ย ย ย ย ย ย color: var(--text-primary);
ย ย ย ย ย ย margin-bottom: 12px;
ย ย ย ย ย ย font-size: 1.1rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 8px;
ย ย ย ย }

ย ย ย ย .pets-grid {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(2, 1fr);
ย ย ย ย ย ย gap: 10px;
ย ย ย ย ย ย margin-bottom: 10px;
ย ย ย ย }

ย ย ย ย .pet-card {
ย ย ย ย ย ย position: relative;
ย ย ย ย ย ย border-radius: 12px;
ย ย ย ย ย ย overflow: hidden;
ย ย ย ย ย ย box-shadow: 0 4px 8px var(--shadow-color);
ย ย ย ย ย ย transition: transform 0.3s ease, box-shadow 0.3s ease;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย aspect-ratio: 1;
ย ย ย ย }

ย ย ย ย .pet-card:hover {
ย ย ย ย ย ย transform: translateY(-4px);
ย ย ย ย ย ย box-shadow: 0 8px 16px var(--shadow-color);
ย ย ย ย }

ย ย ย ย .pet-card img {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 100%;
ย ย ย ย ย ย object-fit: cover;
ย ย ย ย }

ย ย ย ย .pet-card-overlay {
ย ย ย ย ย ย position: absolute;
ย ย ย ย ย ย bottom: 0;
ย ย ย ย ย ย left: 0;
ย ย ย ย ย ย right: 0;
ย ย ย ย ย ย background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 8px;
ย ย ย ย ย ย font-size: 0.85rem;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย text-align: center;
ย ย ย ย }

ย ย ย ย .pet-badge {
ย ย ย ย ย ย position: absolute;
ย ย ย ย ย ย top: 8px;
ย ย ย ย ย ย right: 8px;
ย ย ย ย ย ย background: #ff6b6b;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 4px 8px;
ย ย ย ย ย ย border-radius: 12px;
ย ย ย ย ย ย font-size: 0.75rem;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }

ย ย ย ย /* Modal de Login */
ย ย ย ย .modal {
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย z-index: 9999;
ย ย ย ย ย ย left: 0;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 100%;
ย ย ย ย ย ย background: rgba(0,0,0,0.6);
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;
ย ย ย ย }

ย ย ย ย .modal.active {
ย ย ย ย ย ย display: flex;
ย ย ย ย }

ย ย ย ย .modal-content {
ย ย ย ย ย ย background: var(--bg-secondary);
ย ย ย ย ย ย padding: 30px;
ย ย ย ย ย ย border-radius: 12px;
ย ย ย ย ย ย width: 90%;
ย ย ย ย ย ย max-width: 400px;
ย ย ย ย ย ย box-shadow: 0 8px 32px var(--shadow-color);
ย ย ย ย ย ย position: relative;
ย ย ย ย }

ย ย ย ย /* Estilos de Autenticaรงรฃo, nรฃo repetidos para concisรฃo */

ย ย ย ย .auth-required-message {
ย ย ย ย ย ย background: #fff3cd;
ย ย ย ย ย ย color: #856404;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย border: 1px solid #ffeaa7;
ย ย ย ย }

ย ย ย ย [data-theme="dark"] .auth-required-message {
ย ย ย ย ย ย background: #3d3d1f;
ย ย ย ย ย ย color: #f4d03f;
ย ย ย ย ย ย border-color: #5a5a2f;
ย ย ย ย }

ย ย ย ย @media (max-width: 768px) {
ย ย ย ย ย ย .header-controls {
ย ย ย ย ย ย ย ย position: static;
ย ย ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย ย ย margin-top: 15px;
ย ย ย ย ย ย }

ย ย ย ย ย ย .container {
ย ย ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย }

ย ย ย ย ย ย .sidebar {
ย ย ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย ย ย max-height: 50vh;
ย ย ย ย ย ย }

ย ย ย ย ย ย #map {
ย ย ย ย ย ย ย ย height: 50vh;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ย ย ย <div id="loginModal" class="modal">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <span class="close-modal" onclick="closeLoginModal()">&times;</span>
ย ย ย ย ย ย <h2>๐พ Login / Cadastro</h2>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="auth-tabs">
ย ย ย ย ย ย ย ย <button class="auth-tab active" onclick="switchTab('login')">Login</button>
ย ย ย ย ย ย ย ย <button class="auth-tab" onclick="switchTab('register')">Cadastro</button>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="loginEmail">Email:</label>
ย ย ย ย ย ย ย ย ย ย <input type="email" id="loginEmail" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="loginPassword">Senha:</label>
ย ย ย ย ย ย ย ย ย ย <input type="password" id="loginPassword" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button type="submit" class="submit-btn">Entrar</button>
ย ย ย ย ย ย ย ย <button type="button" class="google-btn" onclick="loginWithGoogle()">
ย ย ย ย ย ย ย ย ย ย <span>๐</span> Entrar com Google
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย <div id="loginError" class="error-message"></div>
ย ย ย ย ย ย </form>

ย ย ย ย ย ย ย ย ย ย ย ย <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="registerEmail">Email:</label>
ย ย ย ย ย ย ย ย ย ย <input type="email" id="registerEmail" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="registerPassword">Senha (mรญn. 6 caracteres):</label>
ย ย ย ย ย ย ย ย ย ย <input type="password" id="registerPassword" minlength="6" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="registerConfirmPassword">Confirmar Senha:</label>
ย ย ย ย ย ย ย ย ย ย <input type="password" id="registerConfirmPassword" minlength="6" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button type="submit" class="submit-btn">Cadastrar</button>
ย ย ย ย ย ย ย ย <button type="button" class="google-btn" onclick="loginWithGoogle()">
ย ย ย ย ย ย ย ย ย ย <span>๐</span> Cadastrar com Google
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย <div id="registerError" class="error-message"></div>
ย ย ย ย ย ย </form>
ย ย ย ย </div>
ย ย </div>

ย ย <div class="header">
ย ย ย ย <div class="header-controls">
ย ย ย ย ย ย <button class="theme-toggle" onclick="toggleTheme()">
ย ย ย ย ย ย ย ย <span id="themeIcon">๐</span>
ย ย ย ย ย ย </button>
ย ย ย ย ย ย <div id="authControl">
ย ย ย ย ย ย ย ย <button class="login-btn" onclick="openLoginModal()">
ย ย ย ย ย ย ย ย ย ย <span>๐ค</span> Login
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย ย ย <h1>๐พ Mapa de Adoรงรฃo de Animais</h1>
ย ย ย ย <p>Encontre animais para adoรงรฃo perto de vocรช ou cadastre um novo ponto.</p>
ย ย </div>
ย ยย
ย ย <div class="container">
ย ย ย ย <div id="map"></div>
ย ย ย ยย
ย ย ย ย <div class="sidebar">
ย ย ย ย ย ย <button id="toggleViewBtn" class="toggle-btn">Cadastrar Novo Ponto de Adoรงรฃo</button>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div id="sensorInfoSection">
ย ย ย ย ย ย ย ย <h2>Informaรงรตes do seu dispositivo</h2>
ย ย ย ย ย ย ย ย <div class="sensor-info">
ย ย ย ย ย ย ย ย ย ย <div class="sensor"><span>๐ Localizaรงรฃo:</span> <strong id="location">Aguardando...</strong></div>
ย ย ย ย ย ย ย ย ย ย <div class="sensor"><span>๐งญ Bรบssola:</span> <strong id="compass">Aguardando...</strong> <span class="compass-arrow" id="arrow">โฌ๏ธ</span></div>
ย ย ย ย ย ย ย ย ย ย <div class="sensor"><span>๐ Acelerรดmetro:</span> <strong id="motion">Aguardando...</strong></div>
ย ย ย ย ย ย ย ย ย ย <div class="sensor"><span>๐ก Luz ambiente:</span> <strong id="light">Aguardando...</strong></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div id="adoptionFormSection">
ย ย ย ย ย ย ย ย <div id="authRequiredMessage" class="auth-required-message" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ๐ Vocรช precisa fazer login para cadastrar pontos de adoรงรฃo!
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <h2>Cadastrar Novo Ponto de Adoรงรฃo</h2>
ย ย ย ย ย ย ย ย <form id="adoptionForm">
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="ongName">Nome da ONG:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="ongName" required>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="animalName">Nome do Animal:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="animalName" required>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="animalInfo">Info. do Animal:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <textarea id="animalInfo" placeholder="Raรงa, idade, temperamento..."></textarea>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="petPhotos">URLs das Fotos dos Pets (atรฉ 4, separadas por vรญrgula):</label>
ย ย ย ย ย ย ย ย ย ย ย ย <textarea id="petPhotos" placeholder="https://exemplo.com/foto1.jpg, https://exemplo.com/foto2.jpg" rows="3"></textarea>
ย ย ย ย ย ย ย ย ย ย ย ย <small style="color: var(--text-secondary); font-size: 0.85rem;">๐ก Dica: Use URLs do Imgur, Cloudinary ou hospedagem prรณpria</small>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="eventDate">Data do Evento:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="date" id="eventDate" required>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="eventTime">Hora do Evento:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="time" id="eventTime" required>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>๐ Localizaรงรฃo do Ponto (clique no mapa):</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" id="adoptionLat" placeholder="Latitude" readonly required>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" id="adoptionLon" placeholder="Longitude" readonly required>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <button type="submit" class="submit-btn" id="submitBtn">Salvar Ponto de Adoรงรฃo</button>
ย ย ย ย ย ย ย ย ย ย <div id="formStatus" style="margin-top: 10px;"></div>
ย ย ย ย ย ย ย ย </form>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
ย ยย
ย ย <script>
ย ย ย ย let db;
ย ย ย ย let auth;
ย ย ย ย let map;
ย ย ย ย let userMarker;
ย ย ย ย let adoptionMarkers = [];
ย ย ย ย let currentUser = null;

ย ย ย ย // ==== TEMA ====
ย ย ย ย function toggleTheme() {
ย ย ย ย ย ย const html = document.documentElement;
ย ย ย ย ย ย const currentTheme = html.getAttribute('data-theme');
ย ย ย ย ย ย const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
ย ย ย ย ย ย html.setAttribute('data-theme', newTheme);
ย ย ย ย ย ย document.getElementById('themeIcon').textContent = newTheme === 'dark' ? 'โ๏ธ' : '๐';
ย ย ย ย ย ย localStorage.setItem('theme', newTheme);
ย ย ย ย }

ย ย ย ย // Carregar tema salvo
ย ย ย ย const savedTheme = localStorage.getItem('theme') || 'light';
ย ย ย ย document.documentElement.setAttribute('data-theme', savedTheme);
ย ย ย ย document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? 'โ๏ธ' : '๐';

ย ย ย ย // ==== MODAL e AUTH FUNCTIONS (Mantidas) ====

ย ย ย ย function openLoginModal() {
ย ย ย ย ย ย document.getElementById('loginModal').classList.add('active');
ย ย ย ย }

ย ย ย ย function closeLoginModal() {
ย ย ย ย ย ย document.getElementById('loginModal').classList.remove('active');
ย ย ย ย ย ย document.getElementById('loginError').textContent = '';
ย ย ย ย ย ย document.getElementById('registerError').textContent = '';
ย ย ย ย }

ย ย ย ย function switchTab(tab) {
ย ย ย ย ย ย const tabs = document.querySelectorAll('.auth-tab');
ย ย ย ย ย ย const forms = document.querySelectorAll('.auth-form');
ย ย ย ย ย ยย
ย ย ย ย ย ย tabs.forEach(t => t.classList.remove('active'));
ย ย ย ย ย ย forms.forEach(f => f.classList.remove('active'));
ย ย ย ย ย ยย
ย ย ย ย ย ย if (tab === 'login') {
ย ย ย ย ย ย ย ย tabs[0].classList.add('active');
ย ย ย ย ย ย ย ย document.getElementById('loginForm').classList.add('active');
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย tabs[1].classList.add('active');
ย ย ย ย ย ย ย ย document.getElementById('registerForm').classList.add('active');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย async function handleLogin(event) {
ย ย ย ย ย ย event.preventDefault();
ย ย ย ย ย ย const email = document.getElementById('loginEmail').value;
ย ย ย ย ย ย const password = document.getElementById('loginPassword').value;
ย ย ย ย ย ย const errorDiv = document.getElementById('loginError');

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย await auth.signInWithEmailAndPassword(email, password);
ย ย ย ย ย ย ย ย errorDiv.textContent = '';
ย ย ย ย ย ย ย ย closeLoginModal();
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย errorDiv.textContent = getErrorMessage(error.code);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย async function handleRegister(event) {
ย ย ย ย ย ย event.preventDefault();
ย ย ย ย ย ย const email = document.getElementById('registerEmail').value;
ย ย ย ย ย ย const password = document.getElementById('registerPassword').value;
ย ย ย ย ย ย const confirmPassword = document.getElementById('registerConfirmPassword').value;
ย ย ย ย ย ย const errorDiv = document.getElementById('registerError');

ย ย ย ย ย ย if (password !== confirmPassword) {
ย ย ย ย ย ย ย ย errorDiv.textContent = 'As senhas nรฃo coincidem!';
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย await auth.createUserWithEmailAndPassword(email, password);
ย ย ย ย ย ย ย ย errorDiv.textContent = '';
ย ย ย ย ย ย ย ย closeLoginModal();
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย errorDiv.textContent = getErrorMessage(error.code);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย async function loginWithGoogle() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const provider = new firebase.auth.GoogleAuthProvider();
ย ย ย ย ย ย ย ย await auth.signInWithPopup(provider);
ย ย ย ย ย ย ย ย closeLoginModal();
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย const errorDiv = document.querySelector('.auth-form.active .error-message');
ย ย ย ย ย ย ย ย errorDiv.textContent = getErrorMessage(error.code);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function logout() {
ย ย ย ย ย ย auth.signOut();
ย ย ย ย }

ย ย ย ย function getErrorMessage(code) {
ย ย ย ย ย ย const messages = {
ย ย ย ย ย ย ย ย 'auth/email-already-in-use': 'Este email jรก estรก em uso!',
ย ย ย ย ย ย ย ย 'auth/invalid-email': 'Email invรกlido!',
ย ย ย ย ย ย ย ย 'auth/user-not-found': 'Usuรกrio nรฃo encontrado!',
ย ย ย ย ย ย ย ย 'auth/wrong-password': 'Senha incorreta!',
ย ย ย ย ย ย ย ย 'auth/weak-password': 'Senha muito fraca! Use pelo menos 6 caracteres.',
ย ย ย ย ย ย ย ย 'auth/too-many-requests': 'Muitas tentativas. Tente novamente mais tarde.',
ย ย ย ย ย ย ย ย 'auth/popup-closed-by-user': 'Login cancelado pelo usuรกrio.'
ย ย ย ย ย ย };
ย ย ย ย ย ย return messages[code] || 'Erro ao realizar operaรงรฃo. Tente novamente.';
ย ย ย ย }

ย ย ย ย function updateAuthUI(user) {
ย ย ย ย ย ย const authControl = document.getElementById('authControl');
ย ย ย ย ย ย const authRequiredMessage = document.getElementById('authRequiredMessage');
ย ย ย ย ย ย const submitBtn = document.getElementById('submitBtn');
ย ย ย ย ย ยย
ย ย ย ย ย ย if (user) {
ย ย ย ย ย ย ย ย currentUser = user;
ย ย ย ย ย ย ย ย authControl.innerHTML = `
ย ย ย ย ย ย ย ย ย ย <div class="user-info">
ย ย ย ย ย ย ย ย ย ย ย ย <span>๐ค ${user.email}</span>
ย ย ย ย ย ย ย ย ย ย ย ย <button class="logout-btn" onclick="logout()">Sair</button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย authRequiredMessage.style.display = 'none';
ย ย ย ย ย ย ย ย submitBtn.disabled = false;
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย currentUser = null;
ย ย ย ย ย ย ย ย authControl.innerHTML = `
ย ย ย ย ย ย ย ย ย ย <button class="login-btn" onclick="openLoginModal()">
ย ย ย ย ย ย ย ย ย ย ย ย <span>๐ค</span> Login
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย authRequiredMessage.style.display = 'block';
ย ย ย ย ย ย ย ย submitBtn.disabled = true;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // ==== CRIAรรO DO MAPA ====
ย ย ย ย map = L.map('map').setView([-23.5505, -46.6333], 10);
ย ย ย ย L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
ย ย ย ย ย ย attribution: '&copy; OpenStreetMap contributors'
ย ย ย ย }).addTo(map);

ย ย ย ย // ==== INICIALIZAรรO (PONTO CRรTICO) ====
ย ย ย ย async function initializeApp() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // CORREรรO: Buscando a configuraรงรฃo da Serverless Function (sua pasta /api/)
ย ย ย ย ย ย ย ย const response = await fetch('/api/firebaseConfig');
ย ย ย ย ย ย ย ย const firebaseConfig = await response.json();

                // Verificaรงรฃo de erro
                if (!firebaseConfig || !firebaseConfig.projectId) {
                    throw new Error("Erro ao carregar a configuraรงรฃo do Firebase. Verifique o arquivo /api/firebaseConfig.js e as Variรกveis de Ambiente.");
                }

ย ย ย ย ย ย ย ย firebase.initializeApp(firebaseConfig);
ย ย ย ย ย ย ย ย db = firebase.firestore();
ย ย ย ย ย ย ย ย auth = firebase.auth();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย auth.onAuthStateChanged(user => {
ย ย ย ย ย ย ย ย ย ย updateAuthUI(user);
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย console.log('Firebase inicializado com sucesso!');

ย ย ย ย ย ย ย ย initSensorsAndLocation();
ย ย ย ย ย ย ย ย loadAdoptionLocations();
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error('Erro na inicializaรงรฃo:', error);
ย ย ย ย ย ย ย ย alert('Erro crรญtico ao carregar a aplicaรงรฃo. Verifique o console do navegador.');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // ==== SENSORES E LOCALIZAรรO (Mantidas) ====
ย ย ย ย function initSensorsAndLocation() {
ย ย ย ย ย ย const userIcon = L.divIcon({ html: "๐", className: "user-icon leaflet-div-icon", iconSize: [24, 24], iconAnchor: [12, 12] });
ย ย ย ย ย ย userMarker = L.marker([0, 0], { icon: userIcon }).addTo(map);

ย ย ย ย ย ย if (navigator.geolocation) {
ย ย ย ย ย ย ย ย navigator.geolocation.watchPosition(
ย ย ย ย ย ย ย ย ย ย position => {
ย ย ย ย ย ย ย ย ย ย ย ย const { latitude, longitude } = position.coords;
ย ย ย ย ย ย ย ย ย ย ย ย userMarker.setLatLng([latitude, longitude]);
ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById("location").textContent = `Lat: ${latitude.toFixed(5)}, Lon: ${longitude.toFixed(5)}`;
ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย error => {
ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById("location").textContent = `Erro: ${error.message}`;
ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย { enableHighAccuracy: true }
ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย document.getElementById("location").textContent = "Geolocalizaรงรฃo nรฃo suportada.";
ย ย ย ย ย ย }

ย ย ย ย ย ย if (window.DeviceOrientationEvent) {
ย ย ย ย ย ย ย ย window.addEventListener("deviceorientation", function(event) {
ย ย ย ย ย ย ย ย ย ย if (event.absolute || event.webkitCompassHeading !== undefined) {
ย ย ย ย ย ย ย ย ย ย ย ย const heading = event.webkitCompassHeading || 360 - event.alpha;
ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById("compass").textContent = heading.toFixed(2) + "ยฐ";
ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById("arrow").style.transform = `rotate(${heading}deg)`;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }, true);
ย ย ย ย ย ย } else { document.getElementById("compass").textContent = "Nรฃo suportado."; }

ย ย ย ย ย ย if (window.DeviceMotionEvent) {
ย ย ย ย ย ย ย ย window.addEventListener("devicemotion", function(event) {
ย ย ย ย ย ย ย ย ย ย const { x, y, z } = event.acceleration || { x: 0, y: 0, z: 0 };
ย ย ย ย ย ย ย ย ย ย document.getElementById("motion").textContent = `X: ${x.toFixed(2)}, Y: ${y.toFixed(2)}, Z: ${z.toFixed(2)}`;
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย } else { document.getElementById("motion").textContent = "Nรฃo suportado."; }

ย ย ย ย ย ย if ('AmbientLightSensor' in window) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const sensor = new AmbientLightSensor();
ย ย ย ย ย ย ย ย ย ย sensor.addEventListener('reading', () => { document.getElementById("light").textContent = sensor.illuminance + " lux"; });
ย ย ย ย ย ย ย ย ย ย sensor.start();
ย ย ย ย ย ย ย ย } catch (err) { document.getElementById("light").textContent = `Erro: ${err.message}`; }
ย ย ย ย ย ย } else { document.getElementById("light").textContent = "Nรฃo suportado."; }
ย ย ย ย }

ย ย ย ย // ==== FIRESTORE E MAPA (Mantidas) ====
ย ย ย ย async function loadAdoptionLocations() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const snapshot = await db.collection('adoptionLocations').get();
ย ย ย ย ย ย ย ย snapshot.forEach(doc => {
ย ย ย ย ย ย ย ย ย ย const data = doc.data();
ย ย ย ย ย ย ย ย ย ย if (data.localizacao && data.localizacao.latitude && data.localizacao.longitude) {
ย ย ย ย ย ย ย ย ย ย ย ย addAdoptionMarker(data);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย console.log('Pontos de adoรงรฃo carregados!');
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error('Erro ao carregar pontos:', error);
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function addAdoptionMarker(data) {
ย ย ย ย ย ย const lat = data.localizacao.latitude;
ย ย ย ย ย ย const lon = data.localizacao.longitude;
ย ย ย ย ย ยย
ย ย ย ย ย ย let petPhotos = [];
ย ย ย ย ย ย if (data.pet_photos) {
ย ย ย ย ย ย ย ย if (typeof data.pet_photos === 'string') {
ย ย ย ย ย ย ย ย ย ย petPhotos = data.pet_photos.split(',').map(url => url.trim()).filter(url => url);
ย ย ย ย ย ย ย ย } else if (Array.isArray(data.pet_photos)) {
ย ย ย ย ย ย ย ย ย ย petPhotos = data.pet_photos;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย if (petPhotos.length === 0) {
ย ย ย ย ย ย ย ย petPhotos = [
ย ย ย ย ย ย ย ย ย ย 'https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=400',
ย ย ย ย ย ย ย ย ย ย 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400',
ย ย ย ย ย ย ย ย ย ย 'https://images.unsplash.com/photo-1518791841217-8f162f1e1131?w=400',
ย ย ย ย ย ย ย ย ย ย 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400'
ย ย ย ย ย ย ย ย ];
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย petPhotos = petPhotos.slice(0, 4);
ย ย ย ย ย ยย
ย ย ย ย ย ย let galleryHTML = '';
ย ย ย ย ย ย if (petPhotos.length > 0) {
ย ย ย ย ย ย ย ย galleryHTML = `
ย ย ย ย ย ย ย ย ย ย <div class="pets-gallery">
ย ย ย ย ย ย ย ย ย ย ย ย <h4>๐พ Pets Disponรญveis</h4>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="pets-grid">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${petPhotos.map((photo, index) => `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="pet-card">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <img src="${photo}" alt="Pet ${index + 1}" onerror="this.src='https://via.placeholder.com/200x200/4facfe/ffffff?text=๐พ'">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="pet-card-overlay">Pet ${index + 1}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${index === 0 ? '<div class="pet-badge">โญ Destaque</div>' : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย `).join('')}
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย const popupContent = `
ย ย ย ย ย ย ย ย <div class="adoption-popup">
ย ย ย ย ย ย ย ย ย ย <h3>๐ ${data.nome_ong}</h3>
ย ย ย ย ย ย ย ย ย ย <div class="adoption-info">
ย ย ย ย ย ย ย ย ย ย ย ย <p><strong>๐ Animal:</strong> ${data.animal_nome}</p>
ย ย ย ย ย ย ย ย ย ย ย ย <p><strong>โน๏ธ Info:</strong> ${data.animal_info || 'Informaรงรตes nรฃo disponรญveis'}</p>
ย ย ย ย ย ย ย ย ย ย ย ย <p><strong>๐ Data:</strong> ${data.data_evento}</p>
ย ย ย ย ย ย ย ย ย ย ย ย <p><strong>๐ Horรกrio:</strong> ${data.horario_evento}</p>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ${galleryHTML}
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย ยย
ย ย ย ย ย ย const adoptionIcon = L.divIcon({ย
ย ย ย ย ย ย ย ย html: "๐พ",ย
ย ย ย ย ย ย ย ย className: "adoption-icon leaflet-div-icon",ย
ย ย ย ย ย ย ย ย iconSize: [32, 32],ย
ย ย ย ย ย ย ย ย iconAnchor: [16, 16]ย
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย const newMarker = L.marker([lat, lon], { icon: adoptionIcon })
ย ย ย ย ย ย ย ย .addTo(map)
ย ย ย ย ย ย ย ย .bindPopup(popupContent, {ย
ย ย ย ย ย ย ย ย ย ย maxWidth: 380,
ย ย ย ย ย ย ย ย ย ย className: 'adoption-popup-container'
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย adoptionMarkers.push(newMarker);
ย ย ย ย }

ย ย ย ย document.getElementById('adoptionForm').addEventListener('submit', async function(e) {
ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!currentUser) {
ย ย ย ย ย ย ย ย alert('Vocรช precisa estar logado para cadastrar um ponto de adoรงรฃo!');
ย ย ย ย ย ย ย ย openLoginModal();
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย const formStatus = document.getElementById('formStatus');
ย ย ย ย ย ย const data = {
ย ย ย ย ย ย ย ย nome_ong: document.getElementById('ongName').value,
ย ย ย ย ย ย ย ย animal_nome: document.getElementById('animalName').value,
ย ย ย ย ย ย ย ย animal_info: document.getElementById('animalInfo').value,
ย ย ย ย ย ย ย ย data_evento: document.getElementById('eventDate').value,
ย ย ย ย ย ย ย ย horario_evento: document.getElementById('eventTime').value,
ย ย ย ย ย ย ย ย pet_photos: document.getElementById('petPhotos').value.split(',').map(url => url.trim()).filter(url => url),
ย ย ย ย ย ย ย ย localizacao: {
ย ย ย ย ย ย ย ย ย ย latitude: parseFloat(document.getElementById('adoptionLat').value),
ย ย ย ย ย ย ย ย ย ย longitude: parseFloat(document.getElementById('adoptionLon').value)
ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย user_email: currentUser.email,
ย ย ย ย ย ย ย ย user_id: currentUser.uid,
ย ย ย ย ย ย ย ย timestamp: firebase.firestore.FieldValue.serverTimestamp()
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย await db.collection('adoptionLocations').add(data);
ย ย ย ย ย ย ย ย formStatus.textContent = 'โ Ponto de adoรงรฃo salvo com sucesso!';
ย ย ย ย ย ย ย ย formStatus.style.color = 'green';
ย ย ย ย ย ย ย ย document.getElementById('adoptionForm').reset();
ย ย ย ย ย ย ย ย addAdoptionMarker(data);
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error('Erro ao salvar:', error);
ย ย ย ย ย ย ย ย formStatus.textContent = 'โ Erro ao salvar. Verifique as permissรตes do Firebase.';
ย ย ย ย ย ย ย ย formStatus.style.color = 'red';
ย ย ย ย ย ย }
ย ย ย ย });
ย ย ย ยย
ย ย ย ย map.on('click', function(e) {
ย ย ย ย ย ย const { lat, lng } = e.latlng;
ย ย ย ย ย ย document.getElementById('adoptionLat').value = lat.toFixed(6);
ย ย ย ย ย ย document.getElementById('adoptionLon').value = lng.toFixed(6);
ย ย ย ย });

ย ย ย ย // ==== INTERFACE (Mantidas) ====
ย ย ย ย document.getElementById('toggleViewBtn').addEventListener('click', function() {
ย ย ย ย ย ย const formSection = document.getElementById('adoptionFormSection');
ย ย ย ย ย ย const sensorSection = document.getElementById('sensorInfoSection');
ย ย ย ย ย ย const button = document.getElementById('toggleViewBtn');
ย ย ย ย ย ย if (formSection.style.display === 'none') {
ย ย ย ย ย ย ย ย formSection.style.display = 'block';
ย ย ย ย ย ย ย ย sensorSection.style.display = 'none';
ย ย ย ย ย ย ย ย button.textContent = 'Ver Minha Localizaรงรฃo e Sensores';
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย formSection.style.display = 'none';
ย ย ย ย ย ย ย ย sensorSection.style.display = 'block';
ย ย ย ย ย ย ย ย button.textContent = 'Cadastrar Novo Ponto de Adoรงรฃo';
ย ย ย ย ย ย }
ย ย ย ย });
ย ย ย ยย
ย ย ย ย // Inicializa a aplicaรงรฃo
ย ย ย ย initializeApp();
ย ย </script>
</body>
</html>
